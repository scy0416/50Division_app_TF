{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
  <div class="d-flex flex-column">
    <div class="item d-flex justify-content-end">
      <button onclick="editMode()" class="btn btn-primary" id="editBtn" {% if post.user_id!=session.get('user_id') %}disabled{% endif %}>글 수정</button>
      <button onclick="saveMode()" data-url="'{{ url_for('admin.notice_detail', post_id=post.id) }}'" class="btn btn-primary" id="saveBtn" style="display:none;">글 저장</button>
      <button onclick="deleteCheck('{{ url_for('admin.notice_detail', post_id=post.id) }}')" clas="btn btn-primary" id="delBtn"
              {% if post.user_id!=session.get('user_id') %}disabled{% endif %}>삭제</button>
    </div>
    <div class="">제목</div>
    <input type="text" id="subject" readonly value="{{ post.subject }}">
    <div class="">내용</div>
    <textarea rows="10" id="content" readonly style="resize:none;">{{ post.content }}</textarea>
  </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
  function editMode(){
    $("#subject").removeAttr('readonly');
    $("#content").removeAttr('readonly');
    $("#editBtn").css('display','none');
    $("#saveBtn").css('display','block');
  }
  function saveMode(){
    $("#subject").attr('readonly');
    $("#content").attr('readonly');
    $("#editBtn").css('display','block');
    $("#saveBtn").css('display','none');
    getPatch($("#saveBtn").dataset.url);
  }
  async function getPatch(url){
    try{
      const data = {
        subject: $("#subject").val(),
        content: $("#content").val()
      };
      const response = await fetch(url, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });
      if(!response.ok){
        throw new Error('Error: ${response.statusText}');
      }
      const responseData = await response.json();
      console.log('Data sent successfully:', responseData);
    } catch(error){
      console.error('Error:', error);
      alert('오류가 발생했습니다.');
    }
  }
  function deleteCheck(url){
    if(confirm("정말로 삭제하시겠습니까?")){
      delNotice(url);
    }
  }
  async function delNotice(url){
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if(!response.ok){
        throw new Error('네트워크 응답이 올바르지 않습니다.');
      }
      return response.json();
    })
    .then(data => {
      console.log('성공적으로 삭제되었습니다.:', data);
    })
    .then(()=>{
      location.href="{{ url_for('admin.notice') }}";
    })
    .catch(error => {
      console.error('삭제 중 에러가 발생했습니다.:', error);
    })
  }
</script>
{% endblock %}