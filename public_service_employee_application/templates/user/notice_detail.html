{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
    <div class="d-flex flex-column">
        <div>제목</div>
        <div>{{ post.subject }}</div>
        <div>내용</div>
        <div>{{ post.content }}</div>
    </div>
    <!-- 댓글 -->
    {% if post.comment_set|length > 0 %}
    <div class="mt-3">
        {% for comment in post.comment_set %}
        <div class="comment py-2 text-muted">
            {% if g.user == comment.user %}
            <div class="d-flex">
                <div>
                    <form method="post" action="{{ url_for('employee.edit_comment', comment_id=comment.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="form_id" value="modify">
                        <textarea readonly style="resize:none" name="content" id="comment_{{ comment.id }}">{{ comment.content }}</textarea>
                        <button type="button" onclick="modify($(this))" class="btn btn-primary" data-comment_id="{{ comment.id }}" id="modify_{{ comment.id }}">수정</button>
                        <button class="btn btn-primary" onclick="save($(this))" style="display:none" data-comment_id="{{ comment.id }}" id="save_{{ comment.id }}">저장</button>
                        <span>- {{ comment.user.name }}, {{ comment.create_date|datetime }}{% if comment.modify_date %}(수정됨){% endif %}</span>
                    </form>
                </div>
                <div>
                    <form method="post" action="{{ url_for('employee.delete_comment', comment_id=comment.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="form_id" value="delete">
                        <button class="small btn">삭제</button>
                    </form>
                </div>
            </div>
            {% else %}
            <textarea readonly stle="resize:none">{{ comment.content }}</textarea>
            <span>- {{ comment.user.name }}, {{ comment.create_date|datetime }}</span>
            {% endif %}
        </div>
        {% endfor %}
        <div>
            <form method="post" action="{{ url_for('employee.create_comment') }}">
                {{ form.csrf_token }}
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <input type="hidden" name="subject" value="none">
                <div>
                    댓글 작성
                </div>
                <div>
                    <textarea name="content" rows="10" style="resize:none;"></textarea>
                </div>
                <button class="btn btn-primary">등록</button>
            </form>
        </div>
    </div>
    {% endif %}
    <!-- 댓글 끝 -->
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    function modify(element){
        $("#comment_"+element.data("comment_id")).removeAttr("readonly");
        element.css('display', 'none');
        $("#save_"+element.data("comment_id")).css('display', 'block');
    }
    function save(element){
        $("#comment_"+element.data("comment_id")).attr('readonly');
        $("#modify_"+element.data("comment_id")).css('display', 'block');
        element.css('display','none');
    }
</script>
{% endblock %}