{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
  <div class="d-flex flex-column">
    <div class="">제목</div>
    <div>{{ post.subject }}</div>
    <table class="table">
      <thead>
      <tr class="text-center thead-dark">
        <th>작성자</th>
        <th>직책</th>
        <th>부대명</th>
        <th>작성일시</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>{{ post.user.name }}</td>
        <td>{{ post.user.position }}</td>
        <td>{{ post.user.unit_name }}</td>
        <td>{{ post.create_date|datetime }}</td>
      </tr>
      </tbody>
    </table>
    <div>내용</div>
    <div>{{ post.content }}</div>
  </div>
  <!-- 댓글 -->
  {% if post.comment_set|length > 0 %}
  <div class="mt-3">
    {% for comment in post.comment_set %}
    <div class="comment py-2 text-muted">
      {% if g.user == comment.user %}
      <div class="d-flex">
        <!-- 로그인 한 사람의 댓글인 경우 -->
        <div>
          <form method="post" action="{{ url_for('employee.edit_comment_grievance', comment_id=comment.id) }}">
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <textarea readonly style="resize:none" name="content" id="comment_{{ comment.id }}">{{ comment.content }}</textarea>
            <button type="button" onclick="modify($(this))" class="btn btn-primary" data-comment_id="{{ comment.id }}" id="modify_{{ comment.id }}">수정</button>
            <button class="btn btn-primary" onclick="save($(this))" style="display:none" data-comment_id="{{ comment.id }}" id="save_{{ comment.id }}">저장</button>
            <span>- {{ comment.user.name }}, {{ comment.create_date|datetime }}{% if comment.modify_date %}(수정됨){% endif %}</span>
          </form>
        </div>
        <div>
          <form method="post" action="{{ url_for('employee.delete_comment_grievance', comment_id=comment.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <button class="small btn">삭제</button>
          </form>
        </div>
      </div>
      {% else %}
      <div>
        <!-- 로그인 한 사람의 댓글이 아닌 경우 -->
        <span>{{ comment.content }}- {{ comment.user.name }}, {{ comment.create_date|datetime }}</span>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}
  <!-- 댓글 작성 -->
  <div>
    <form method="post" action="{{ url_for('employee.create_comment_grievance') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="form_id" value="post">
      <input type="hidden" name="post_id" value="{{ post.id }}">
      <label>댓글 입력</label>
      <textarea name="content" rows="10" style="resize:none;"></textarea>
      <button class="btn btn-primary">등록</button>
    </form>
  </div>
  <!-- 댓글 끝 -->
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
  function modify(element){
    $("#comment_"+element.data("comment_id")).removeAttr('readonly');
    element.css('display', 'none');
    $("#save_"+element.data("comment_id")).css('display', 'block');
  }
  function save(element){
    $("#comment_"+element.data("comment_id")).attr('readonly');
    $("#modify_"+element.data("comment_id")).css('display', 'block');
    element.css('display', 'none');
  }
</script>
{% endblock %}