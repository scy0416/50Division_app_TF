{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
    <div class="d-flex justify-content-end">
        <button onclick="showSearch()" class="btn btn-primary">상세검색</button>
    </div>
    <table class="table">
        <thead>
        <tr class="text-center thead-dark">
            <th>번호</th>
            <th>이름</th>
            <th>부대명</th>
            <th>직책</th>
            <th>생년월일</th>
        </tr>
        </thead>
        <tbody>
        {% if user_list.items %}
        {% for user in user_list.items %}
        <tr class="text-center">
            <td rowspan="4" style="border-right-width:thin;" class="align-middle">{{ user_list.total - ((user_list.page-1) * user_list.per_page) - loop.index0 }}</td>
            <td class="text-left">{{ user.name }}</td>
            <td>{{ user.unit_name }}</td>
            <td>{{ user.position }}</td>
            <td>{{ user.birth_date }}</td>
        </tr>
        <tr class="text-center">
            <th rowspan="3" style="border-right-width:thin;" class="align-middle">교육명</th>
            <td colspan="2" class="text-start">성희롱 예방 교육</td>
            <td>{{ user.sexual_harassment_prevent }}</td>
        </tr>
        <tr class="text-center">
            <td colspan="2" class="text-start">장애인식 개선 교육</td>
            <td>{{ user.disability_awareness_improvement }}</td>
        </tr>
        <tr class="text-center">
            <td colspan="2" class="text-start">직장 내 괴롭힘 예방 교육</td>
            <td>{{ user.workplace_harassment_prevent }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
            <td colspan="5">사용자가 없습니다</td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    <!-- 페이징 처리 시작 -->
    <ul class="pagination justify-content-center">
        <!-- 이전 페이지 -->
        {% if user_list.has_prev %}
        <li class="page-item">
            <a class="page-link" data-page="{{ user_list.prev_num }}" href="#">이전</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" tabindex="-1" aria-disabled="tre" href="#">이전</a>
        </li>
        {% endif %}
        {% for page_num in user_list.iter_pages() %}
        {% if page_num %}
        {% if page_num != user_list.page %}
        <li class="page-item">
            <a class="page-link" data-page="{{ page_num }}" href="#">{{ page_num }}</a>
        </li>
        {% else %}
        <li class="page-item active" aria-current="page">
            <a class="page-link" href="#">{{ page_num }}</a>
        </li>
        {% endif %}
        {% else %}
        <li class="disabled">
            <a class="page-link" href="#">...</a>
        </li>
        {% endif %}
        {% endfor %}
        <!-- 다음 페이지 -->
        {% if user_list.has_next %}
        <li class="page-item">
            <a class="page-link" data-page="{{ user_list.next_num }}" href="#">다음</a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
        </li>
        {% endif %}
    </ul>
    <!-- 페이징 처리 끝 -->
    <dialog id="search">
        <h3>상세 검색</h3>
        <form method="get" class="get-form" id="searchForm">
            <div class="form-group">
                <label for="name">이름</label>
                <input type="text" class="form-control" name="name" id="name" value="{{ form.name.data or '' }}">
            </div>
            <div class="form-group">
                <label for="unitName">부대명</label>
                <input type="text" class="form-control" name="unitName" id="unitName" value="{{ form.unit_name.data or '' }}">
            </div>
            <div class="form-group">
                <label for="position">직책</label>
                <input type="text" class="form-control" name="position" id="position" value="{{ form.position.data or '' }}">
            </div>
            <div class="form-group">
                <label for="birthDate">생년월일</label>
                <input type="date" class="form-control" name="birthDate" id="birthDate" value="{{ form.birth_date.data or '' }}">
            </div>
            <input type="hidden" id="page" name="page" value="{{ page }}">
            <button type="button" onclick="closeSearch()" class="btn btn-primary">취소</button>
            <button type="button" class="btn btn-primary" id="btn_search">검색</button>
        </form>
    </dialog>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    function showSearch(){
        var dialog = document.getElementById("search");
        dialog.showModal();
    }
    function closeSearch(){
        event.preventDefault();
        var dialog = document.getElementById("search");
        dialog.close()
    }
    $(document).ready(function(){
        $(".page-link").on('click', function(){
            $("#page").val($(this).data("page"));
            $("#searchForm").submit();
        });
        $("#btn_search").on('click', function(){
            $("#page").val(1);
            $("#searchForm").submit();
        });
    });
</script>
{% endblock %}