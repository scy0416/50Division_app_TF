{% extends 'base.html' %}
{% block content %}
<div class="container my-3">
  <div class="d-flex justify-content-end">
    <button onclick="showAddEmployee()" class="btn btn-primary" style="margin: 1px;">사용자 추가</button>
    <button onclick="showAddAdmin()" class="btn btn-primary" style="margin: 1px;">관리자 추가</button>
    <div>
      <dialog id="addAdmin">
        <h3>관리자 추가</h3>
        <form method="post" class="post-form" id="adminForm">
          {{ adminForm.csrf_token }}
          {% include "adminForm_errors.html" %}
          <input type="hidden" name="form_id" value="addAdmin">
          <div class="form-group">
            <label for="id">id</label>
            <input type="text" class="form-control" name="id" id="id" value="{% if g.addAdmin_error %}{{ adminForm.id.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="password1">비밀번호</label>
            <input type="password" class="form-control" name="password1" id="password1" value="{% if g.addAdmin_error %}{{ adminForm.password1.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="password2">비밀번호 확인</label>
            <input type="password" class="form-control" name="password2" id="password2" value="{% if g.addAdmin_error %}{{ adminForm.password2.data or '' }}{% endif %}">
          </div>
          <button type="button" onclick="closeAddAdmin()" class="btn btn-primary" id="closeAddAdmin_button">취소</button>
          <button type="submit" class="btn btn-primary">생성하기</button>
        </form>
      </dialog>
      <dialog id="addEmployee">
        <h3>공무직원 추가</h3>
        <form method="post" class="post-form" id="employeeForm">
          {{ employeeForm.csrf_token }}
          {% include "employeeForm_errors.html" %}
          <input type="hidden" name="form_id" value="addEmployee">
          <div class="form-group">
            <label for="name">이름</label>
            <input type="text" class="form-control" name="name" id="name" value="{% if g.addEmployee_error %}{{ employeeForm.name.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="unit_name">부대명</label>
            <input type="text" class="form-control" name="unit_name" id="unit_name" value="{% if g.addEmployee_error %}{{ employeeForm.unit_name.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="position">직책</label>
            <input type="text" class="form-control" name="position" id="position" value="{% if g.addEmployee_error %}{{ employeeForm.position.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="birth_date">생년월일</label>
            <input type="date" name="birth_date" id="birth_date" value="{% if g.addEmployee_error %}{{ employeeForm.birth_date.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="hire_date">채용일</label>
            <input type="date" name="hire_date" id="hire_date" value="{% if g.addEmployee_error %}{{ employeeForm.hire_date.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="retirement_date">퇴직일</label>
            <input type="date" name="retirement_date" id="retirement_date" value="{% if g.addEmployee_error %}{{ employeeForm.retirement_date.data or '' }}{% endif %}">
          </div>
          <div class="form-group">
            <label for="employment_type">고용형태</label>
            <select name="employment_type" id="employment_type">
              {% for value, label in employeeForm.employment_type.choices %}
              <option value="{{ value }}">{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="bigo">비고</label>
            <input type="text" class="form-control" name="bigo" id="bigo" value="{% if g.addEmployee_error %}{{ employeeForm.bigo.data or '' }}{% endif %}">
          </div>
          <button type="button" onclick="closeAddEmployee()" class="btn btn-primary" id="closeAddEmployee_button">취소</button>
          <button type="submit" class="btn btn-primary">생성하기</button>
        </form>
      </dialog>
    </div>
  </div>
  <table class="table">
    <thead>
    <tr class="text-center thead-dark">
      <th>번호</th>
      <th>이름</th>
      <th>부대명</th>
      <th>직책</th>
      <th>생년월일</th>
    </tr>
    </thead>
    <tbody>
    {% if user_list %}
    {% for user in user_list.items %}
    <tr class="text-center">
      <td>{{ user_list.total - ((user_list.page-1) * user_list.per_page) - loop.index0 }}</td>
      <td class="text-left">
        <a href="{{ url_for('admin.detail', user_id=user.id) }}">{{ user.name }}</a>
      </td>
      <td>{{ user.unit_name }}</td>
      <td>{{ user.position }}</td>
      <td>{{ user.birth_date }}</td>
    </tr>
    {% endfor %}
    {% else %}
    <tr>
      <td colspan="5">질문이 없습니다.</td>
    </tr>
    {% endif %}
    </tbody>
  </table>
  <!-- 페이징 처리 시작 -->
  <ul class="pagination justify-content-center">
    <!-- 이전 페이지 -->
    {% if user_list.has_prev %}
    <li class="page-item">
      <a class="page-link" href="?page={{ user_list.prev_num }}">이전</a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
    </li>
    {% endif %}
    {% for page_num in user_list.iter_pages() %}
    {% if page_num %}
    {% if page_num != user_list.page %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
    </li>
    {% else %}
    <li class="page-item active" aria-current="page">
      <a class="page-link" href="#">{{ page_num }}</a>
    </li>
    {% endif %}
    {% else %}
    <li class="disabled">
      <a class="page-link" href="#">...</a>
    </li>
    {% endif %}
    {% endfor %}
    <!-- 다음 페이지 -->
    {% if user_list.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ user_list.next_num }}">다음</a>
    </li>
    {% else %}
    <li class="page-item disabled">
      <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
    </li>
    {% endif %}
  </ul>
</div>
{% endblock %}
{% block script %}
<script>
  function showAddAdmin(){
    var dialog = document.getElementById("addAdmin");
    dialog.showModal();
  }
  function closeAddAdmin(){
    event.preventDefault();
    var dialog = document.getElementById("addAdmin");
    dialog.close();
  }
  function showAddEmployee(){
    var dialog = document.getElementById("addEmployee");
    dialog.showModal();
  }
  function closeAddEmployee(){
    event.preventDefault();
    var dialog = document.getElementById("addEmployee");
    dialog.close();
  }
  {% if g.addAdmin_error %}
  showAddAdmin()
  {% endif %}
  {% if g.addEmployee_error %}
  showAddEmployee()
  {% endif %}
</script>
{% endblock %}